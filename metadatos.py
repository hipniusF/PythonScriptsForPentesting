from PyPDF2 import PdfFileReader
import os
import sys
from colorama import Fore


def printMeta():
    try:
        for dirpath, dirnames, files in os.walk(sys.argv[1]):
            for name in files:
                ext = name.lower().rsplit('.', 1)[-1]
                if ext in ['pdf']:
                    print(Fore.YELLOW + "==================================================")
                    print ("\n[+] Metadata for file: " + (dirpath + os.path.sep + name) + Fore.RESET + "\n \n")
                    pdfFile = PdfFileReader(dirpath+os.path.sep+name, 'rb')
                    docInfo = pdfFile.getDocumentInfo()
                    for metaItem in docInfo:
                        print( Fore.RED + "[-] " + metaItem + Fore.RESET + ": " + docInfo[metaItem] + "\n")

                    print(Fore.RED + "[-] " + "/Number of Pages: " + Fore.RESET + str(pdfFile.getNumPages()) + "\n")
                    print(Fore.RED + "[-] " + "/Encrypted: " + Fore.RESET + str(pdfFile.getIsEncrypted()) + "\n")
                    print(Fore.RED + "[-] " + "/Fields: " + Fore.RESET + str(pdfFile.getFields()) + "\n")

                    print(Fore.YELLOW + "==================================================" + Fore.RESET)

    except IndexError:
        print(Fore.CYAN + "\n     No se ha encontrado la carpeta.")
        print(Fore.CYAN + "     Debes indicar la carpeta que contiene los archivos a an√°lizar como argumento. Por ejemplo: ")
        print(Fore.RED + "\n                 python3 metadatos.py ~/Escritorio/docs/ \n")


printMeta()