#Este script solicita dos objetivos de los cuales devuelve la información completa del DNS (records A, MX, NS y AAAA si los hubiera) así como información del whois.
#Además se le puede ingresar el atributo -o seguido de un archivo de output donde escribirá la información obtenida con el escaner.
#También se le puede añadir el atributo --only-file para que el script solo escriba el output en el archivo y no lo saque en el terminal (después de este atributo se debe agregar la dirección del archivo).

import whois
import dns.query
import dns.resolver
import dns.zone
from colorama import Fore
import sys

class Objetivo:
    def __init__(self, domain):
        self.domain = domain

    def dnsInfoA(self):
        a = dns.resolver.query(self.domain, "A")
        return a.response.to_text()

    def dnsInfoMX(self):
        a = dns.resolver.query(self.domain, "MX")
        return a.response.to_text()

    def dnsInfoNS(self):
        a = dns.resolver.query(self.domain, "NS")
        return a.response.to_text()

    def dnsInfoAAAA(self):
        a = dns.resolver.query(self.domain, "AAAA")
        return a.response.to_text()

    def whois(self):
        a = whois.query(self.domain)
        return str(a.__dict__)

objetivo1 = Objetivo(input("Introduce tu primer objetivo: "))
objetivo2 = Objetivo(input("Introduce tu segundo objetivo: "))

objetivos = [objetivo1, objetivo2]

def output(impresion):

    for objetivo in objetivos:
        impresion("\n")
        impresion(Fore.YELLOW + "INFO DEL OBJETIVO (" + objetivo.domain + "):")
        impresion("=========================================================")
        impresion(Fore.RESET)
        impresion("\n \n" + Fore.RED + "Información obtenida del A Record (IPv4): \n" + Fore.RESET)

        try:
            impresion(objetivo.dnsInfoA())
        except:
            impresion(Fore.GREEN + "No se ha encontrado información" + Fore.RESET)

        impresion("\n \n" + Fore.RED + "Información obtenida del MX Record (Servidor de Correo): \n" + Fore.RESET)

        try:
            impresion(objetivo.dnsInfoMX())
        except:
            impresion(Fore.GREEN + "No se ha encontrado información" + Fore.RESET)


        impresion("\n \n" + Fore.RED + "Información obtenida del NS Record (Nombre del servidor): \n" + Fore.RESET)
        try:
            impresion(objetivo.dnsInfoNS())
        except:
            impresion(Fore.GREEN + "No se ha encontrado información" + Fore.RESET)

        impresion("\n \n" + Fore.RED + "Información obtenida del AAAA Record (IPv6): \n" + Fore.RESET)

        try:
            impresion(objetivo.dnsInfoAAAA())
        except:
            impresion(Fore.GREEN + "No se ha encontrado información" + Fore.RESET)

        try:
            impresion("\n \n" + Fore.RED + "Información obtenida del WHOIS: \n" + Fore.RESET)
            x = objetivo.whois().split(", '")
            for i in x:
                impresion(i)
        except:
            impresion(Fore.GREEN + "No se ha encontrado información" + Fore.RESET)

        impresion("\n")
        impresion(Fore.YELLOW + "=========================================================")

        impresion("\n \n \n")

try:
    if (sys.argv[1] == "-o" or "--only-file"):
        file = open(str(sys.argv[2]), "w")
        output(file.write)
except IndexError:
    pass

try:
    if sys.argv[1] != "--only-file":
        output(print)
except IndexError:
    output(print)